<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.food.mapper.CommentMapper">

    <insert id="insertComment" parameterType="com.food.entity.Comment" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO comments (user_id, recipe_id, content, rating, image, created_at)
        VALUES (#{userId}, #{recipeId}, #{content}, #{rating}, #{image}, NOW())
    </insert>

    <select id="selectCommentsByRecipeId" resultType="com.food.entity.Comment">
        SELECT
            c.id,
            c.user_id AS userId,
            c.recipe_id AS recipeId,
            c.content,
            c.rating,
            c.image,  c.created_at AS createdAt,
            u.username,
            u.avatar_file_name AS avatar
        FROM comments c
                 LEFT JOIN users u ON c.user_id = u.id
        WHERE c.recipe_id = #{recipeId}
        ORDER BY c.created_at DESC
    </select>

</mapper>