<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>美食天地 - 个人中心</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="static/css/style.css">
    <link rel="stylesheet" href="static/css/profile.css">
    <style>
       </style>
</head>
<body>
<nav class="navbar">
    <div class="nav-title"><i class="fas fa-utensils"></i><span>美食天地</span></div>
    <div class="nav-center">
        <ul class="nav-links">
            <li><a href="index.html">首页</a></li>
            <li><a href="cuisine.html">菜系分类</a></li>
            <li><a href="recommendation.html">菜品推荐</a></li>
            <li><a href="market.html">食材商城</a></li>
            <li><a href="my_recipes.html">我的食谱</a></li>
            <li><a href="profile.html" style="background-color: rgba(255,255,255,0.2);">个人中心</a></li>
            <li><a href="admin.html">后台管理</a></li>
            <li id="authSection"><a href="register.html">登录/注册</a></li>
        </ul>
    </div>
</nav>

<div class="page-content">
    <h1 class="page-title">个人中心</h1>
    <div id="profileContent"></div>
</div>

<div id="orderDetailModal" class="modal">
    <div class="modal-content" style="width: 600px; max-width: 90%; margin-top: 10vh;">
        <span class="close-modal" onclick="closeOrderModal()">&times;</span>
        <h3 style="border-bottom: 1px solid #eee; padding-bottom: 15px; margin-bottom: 15px; color: #664b2e; font-size: 20px;">
            <i class="fas fa-file-invoice-dollar"></i> 订单详情
        </h3>
        <div style="margin-bottom: 20px; background: #fdf6ec; padding: 15px; border-radius: 8px; border: 1px solid #faeccd;">
            <div style="margin-bottom: 8px;">
                <span style="color:#888; width: 70px; display:inline-block;">订单号：</span>
                <span id="modalOrderNo" style="font-weight:bold; color:#3e2c1c; font-family:monospace;"></span>
            </div>
            <div style="margin-bottom: 8px;">
                <span style="color:#888; width: 70px; display:inline-block;">时间：</span>
                <span id="modalOrderTime" style="color:#555;"></span>
            </div>
            <div style="margin-bottom: 8px;">
                <span style="color:#888; width: 70px; display:inline-block;">收货人：</span>
                <span id="modalReceiver" class="display-text" style="color:#555; display:inline;"></span>
                <input id="editReceiverName" class="edit-input" type="text" placeholder="收货人姓名">
            </div>
            <div style="margin-bottom: 8px;">
                <span style="color:#888; width: 70px; display:inline-block;">电话：</span>
                <span id="modalPhone" class="display-text" style="color:#555; display:inline;"></span>
                <input id="editReceiverPhone" class="edit-input" type="text" placeholder="联系电话">
            </div>
            <div>
                <span style="color:#888; width: 70px; display:inline-block;">地址：</span>
                <span id="modalAddress" class="display-text" style="color:#555; display:inline;"></span>
                <textarea id="editReceiverAddress" class="edit-input" rows="2" placeholder="详细地址"></textarea>
            </div>
        </div>

        <h4 style="margin: 15px 0 10px 0; color: #f7941e; font-size: 16px;">商品清单</h4>
        <div id="modalItemsList" style="max-height: 300px; overflow-y: auto; padding-right: 5px;"></div>

        <div style="text-align: right; margin-top: 20px; border-top: 1px solid #eee; padding-top: 15px; display: flex; justify-content: space-between; align-items: center;">
            <span style="color: #888;">共 <span id="modalTotalCount">0</span> 件商品</span>
            <div>
                实付总额：<span id="modalTotalAmount" style="font-size: 26px; color: #f7941e; font-weight: bold;"></span>
            </div>
        </div>

        <div class="modal-footer-actions">
            <button id="btnStartEdit" class="action-btn btn-edit" onclick="startEditingAddress()">修改地址</button>
            <button id="btnSaveAddress" class="action-btn btn-edit" onclick="saveOrderAddress()" style="display:none; background-color:#8cc63f;">保存</button>
            <button id="btnCancelEdit" class="action-btn btn-secondary" onclick="cancelEditingAddress()" style="display:none;">取消</button>
            <button class="action-btn btn-delete" onclick="deleteCurrentOrder()">删除订单</button>
        </div>
    </div>
</div>

<div id="addressModal" class="modal">
    <div class="modal-content" style="margin-top: 15vh;">
        <span class="close-modal" onclick="closeAddressModal()">&times;</span>
        <h3 id="addrModalTitle" style="color: #664b2e; margin-bottom: 20px;">新增地址</h3>
        <form id="addressForm" onsubmit="saveAddress(event)">
            <input type="hidden" id="addrId">
            <div class="form-group">
                <label class="field-label">地址标签</label>
                <input type="text" id="addrName" placeholder="如：家、公司" required>
            </div>
            <div class="form-group">
                <label class="field-label">收货人</label>
                <input type="text" id="addrRecipient" required>
            </div>
            <div class="form-group">
                <label class="field-label">联系电话</label>
                <input type="tel" id="addrPhone" required>
            </div>
            <div class="form-group">
                <label class="field-label">详细地址</label>
                <textarea id="addrDetail" rows="3" required></textarea>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeAddressModal()" style="margin-right: 10px;">取消</button>
                <button type="submit" class="btn btn-primary">保存</button>
            </div>
        </form>
    </div>
</div>

<div id="profileEditModal" class="modal">
    <div class="modal-content" style="margin-top: 10vh;">
        <span class="close-modal" onclick="document.getElementById('profileEditModal').style.display='none'">&times;</span>
        <h3 style="color: #664b2e; margin-bottom: 25px; border-bottom: 1px solid #eee; padding-bottom: 10px;">修改个人信息</h3>
        <form onsubmit="saveProfileChanges(event)">
            <div class="form-group" style="display: flex; align-items: center; gap: 20px; background: #fffaf0; padding: 15px; border-radius: 8px;">
                <img id="editAvatarPreview" src="static/image/default_avatar.jpg" style="width: 70px; height: 70px; border-radius: 50%; object-fit: cover; border: 2px solid #d9b38c;">
                <div>
                    <label for="editAvatarInput" class="btn btn-sm btn-primary" style="cursor: pointer; display: inline-block;">更换头像</label>
                    <input type="file" id="editAvatarInput" accept="image/*" style="display: none;" onchange="previewEditAvatar(this)">
                    <div style="font-size: 12px; color: #888; margin-top: 5px;">支持 jpg, png 格式</div>
                </div>
            </div>

            <div class="form-group"><label class="field-label">用户名</label><input type="text" id="editUsername" required></div>
            <div class="form-group"><label class="field-label">手机号</label><input type="text" id="editPhone"></div>
            <div class="form-group"><label class="field-label">邮箱</label><input type="email" id="editEmail"></div>

            <div class="form-group">
                <label class="field-label">性别</label>
                <div class="radio-group-container">
                    <label class="radio-label"><input type="radio" name="editGender" value="male"> 男</label>
                    <label class="radio-label"><input type="radio" name="editGender" value="female"> 女</label>
                </div>
            </div>

            <div class="form-group" style="display: block;">
                <label class="field-label">美食偏好</label>
                <div id="editPreferencesList" class="preferences-checkbox-grid"></div>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="document.getElementById('profileEditModal').style.display='none'" style="margin-right: 10px;">取消</button>
                <button type="submit" class="btn btn-primary">保存修改</button>
            </div>
        </form>
    </div>
</div>

<footer class="footer">
    <p>美食天地 - 用心服务每一位美食爱好者 | 联系我们：<a href="https://www.nchu.edu.cn/" target="_blank">南昌航空大学官网</a></p>
</footer>

<script>

</script>
<script src="static/js/common.js"></script>
<script src="static/js/profile.js"></script>
</body>
</html>